<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Examen Oficial Delaware - Versi√≥n Final</title>
    <style>
        :root {
            --primary: #003366;
            --secondary: #1a73e8;
            --success: #28a745;
            --danger: #dc3545;
            --passed-bg: #d4edda;
            --locked-bg: #e9ecef;
            --bg: #f4f7f6;
        }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; padding: 20px; display: flex; justify-content: center; }
        .quiz-container { width: 100%; max-width: 680px; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 8px 25px rgba(0,0,0,0.08); }
        
        .screen { display: none; }
        .active { display: block; }

        /* PORTADA */
        #screen-home { text-align: center; }
        .hero-title { color: var(--primary); margin-bottom: 5px; font-size: 1.8em; }
        .hero-subtitle { color: #666; margin-top: 0; font-size: 1em; }
        .hero-icon { font-size: 45px; margin: 15px 0; }
        
        .feature-box { 
            display: flex; justify-content: space-around; background: #f8f9fa; 
            padding: 15px; border-radius: 8px; margin: 20px 0; font-size: 0.9em; font-weight: 500;
        }
        
        /* TARJETAS DE EXAMEN (LINKS) */
        .exam-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 25px 0; }
        .exam-card { 
            padding: 20px; border: 2px solid #ddd; border-radius: 12px; text-align: center;
            transition: 0.2s; position: relative; background: #fff; display: flex; flex-direction: column; justify-content: space-between;
        }
        
        /* Estados de las tarjetas */
        .exam-card.locked { opacity: 0.6; background: var(--locked-bg); border-color: #ccc; cursor: not-allowed; }
        .exam-card.unlocked { border-color: var(--secondary); box-shadow: 0 4px 10px rgba(26, 115, 232, 0.1); cursor: pointer; }
        .exam-card.unlocked:hover { transform: translateY(-3px); border-color: var(--primary); }
        .exam-card.passed { background-color: var(--passed-bg); border-color: var(--success); }

        .icon-state { font-size: 2em; margin-bottom: 10px; display: block; }
        .exam-title { font-weight: bold; color: #333; display: block; margin-bottom: 5px; }
        .exam-status { font-size: 0.8em; font-weight: bold; text-transform: uppercase; margin-bottom: 10px; display: block; }
        
        .btn-enter {
            background: var(--secondary); color: white; border: none; padding: 8px 15px; 
            border-radius: 5px; font-size: 0.9em; width: 100%; cursor: pointer; font-weight: bold;
        }
        .btn-enter:hover { background: var(--primary); }
        .locked .btn-enter { display: none; }

        /* PREGUNTAS */
        .svg-box { text-align: center; margin-bottom: 15px; height: 90px; display: flex; align-items: center; justify-content: center; }
        svg { max-height: 85px; max-width: 85px; width: auto; }
        
        .option-item { 
            padding: 12px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 10px; 
            cursor: pointer; display: flex; align-items: flex-start; transition: 0.2s; font-size: 0.95em;
        }
        .option-item:hover { background: #f0f7ff; border-color: var(--secondary); }
        .letter { font-weight: bold; margin-right: 12px; background: #eee; padding: 2px 8px; border-radius: 4px; min-width: 20px; text-align: center; }
        
        .correct { border-color: var(--success) !important; background: #e9f7ef !important; }
        .incorrect { border-color: var(--danger) !important; background: #fdf2f2 !important; }

        #feedback { padding: 12px; border-radius: 6px; margin: 15px 0; display: none; border-left: 4px solid; font-size: 0.9em; }
        .fb-success { background: #e6fffa; border-color: var(--success); color: #004d40; }
        .fb-danger { background: #fff5f5; border-color: var(--danger); color: #742a2a; }

        .btn { width: 100%; padding: 14px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 1em; margin-top: 10px; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-secondary { background: #6c757d; color: white; }

        .progress-bar { height: 6px; background: #eee; border-radius: 3px; margin-bottom: 15px; }
        .progress-fill { height: 100%; background: var(--success); width: 0%; border-radius: 3px; transition: 0.3s; }
        
        .tips-box { text-align: left; font-size: 0.9em; color: #555; border-top: 1px solid #eee; padding-top: 15px; margin-top: 20px; }
    </style>
</head>
<body>

<div class="quiz-container">
    <div id="screen-home" class="screen active">
        <h1 class="hero-title">Examen de Conducir - Delaware</h1>
        <p class="hero-subtitle">Practica con se√±ales visuales y situaciones reales de manejo</p>
        
        <div class="hero-icon">üö¶</div>
        
        <h3>Examen Visual Interactivo</h3>
        <p style="font-size: 0.9em; color: #555;">4 ex√°menes de 30 preguntas (120 Total)</p>

        <div class="feature-box">
            <div><span>üõë</span>Se√±ales<br>Recreadas</div>
            <div><span>üöô</span>Situaciones<br>Ilustradas</div>
            <div><span>üìù</span>Feedback<br>Instant√°neo</div>
        </div>

        <div class="exam-grid" id="exam-selector-area"></div>

        <div class="tips-box">
            <strong>üí° Consejos para aprobar:</strong>
            <ul style="padding-left: 20px; margin-top: 5px;">
                <li>Necesitas 80% o m√°s para aprobar (24 de 30 correctas).</li>
                <li>Lee cada pregunta cuidadosamente antes de responder.</li>
                <li>Presta atenci√≥n a las explicaciones despu√©s de cada respuesta.</li>
                <li>Las se√±ales est√°n recreadas para ayudarte a identificarlas por forma y color.</li>
            </ul>
        </div>
        
        <div style="text-align: center; margin-top: 15px;">
            <button onclick="resetStorage()" style="background:none; border:none; color:#999; text-decoration:underline; cursor:pointer; font-size:0.8em;">Reiniciar todo el progreso (Borrar candados)</button>
        </div>
    </div>

    <div id="screen-quiz" class="screen">
        <div class="progress-bar"><div id="progress-fill" class="progress-fill"></div></div>
        <div style="display: flex; justify-content: space-between; font-size: 0.8em; color: #888; margin-bottom: 10px;">
            <span id="q-exam-name" style="font-weight:bold; color:var(--primary);"></span>
            <span id="q-counter"></span>
        </div>
        
        <div id="q-image" class="svg-box"></div>
        <h3 id="q-text" style="margin-top: 0;"></h3>
        
        <div id="options-area"></div>
        <div id="feedback"></div>
        
        <button id="btn-next" class="btn btn-primary" style="display:none;" onclick="handleNext()">Siguiente Pregunta ‚Üí</button>
    </div>

    <div id="screen-result" class="screen" style="text-align: center;">
        <h2 id="res-title"></h2>
        <div style="font-size: 4em; font-weight: bold; margin: 15px 0; color: var(--primary);" id="res-percent">0%</div>
        <p id="res-stats" style="color: #555; font-size: 1.2em;"></p>
        <div id="res-action-area"></div>
        <button class="btn btn-secondary" onclick="showHome()">Volver al Men√∫ Principal</button>
    </div>
</div>

<script>
// IM√ÅGENES SVG
const SVGS = {
    stop: `<svg viewBox="0 0 100 100"><polygon points="30,5 70,5 95,30 95,70 70,95 30,95 5,70 5,30" fill="#cc0000" stroke="#fff" stroke-width="2"/><text x="50" y="60" text-anchor="middle" fill="white" font-weight="bold" font-size="18">STOP</text></svg>`,
    yield: `<svg viewBox="0 0 100 100"><polygon points="50,95 5,10 95,10" fill="white" stroke="#cc0000" stroke-width="8"/><text x="50" y="35" text-anchor="middle" font-size="10" font-weight="bold" fill="#cc0000">CEDA EL</text><text x="50" y="50" text-anchor="middle" font-size="10" font-weight="bold" fill="#cc0000">PASO</text></svg>`,
    school: `<svg viewBox="0 0 100 100"><polygon points="50,5 95,45 80,95 20,95 5,45" fill="#ccff00" stroke="#000" stroke-width="2"/><path d="M40 70 L50 40 L60 70" stroke="black" stroke-width="3" fill="none"/></svg>`,
    railroad: `<svg viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="#ffcc00" stroke="#000" stroke-width="2"/><line x1="15" y1="15" x2="85" y2="85" stroke="black" stroke-width="6"/><line x1="85" y1="15" x2="15" y2="85" stroke="black" stroke-width="6"/><text x="50" y="85" font-size="20" text-anchor="middle" font-weight="bold">R R</text></svg>`,
    noEntry: `<svg viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="#cc0000"/><rect x="20" y="42" width="60" height="16" fill="white"/></svg>`,
    slippery: `<svg viewBox="0 0 100 100"><rect x="10" y="10" width="80" height="80" fill="#ffcc00" stroke="black" transform="rotate(45 50 50)"/><path d="M35 70 Q55 60 35 50 Q15 40 35 30" fill="none" stroke="black" stroke-width="4"/><path d="M65 70 Q85 60 65 50 Q45 40 65 30" fill="none" stroke="black" stroke-width="4"/></svg>`,
    divided: `<svg viewBox="0 0 100 100"><rect x="10" y="10" width="80" height="80" fill="#ffcc00" stroke="black" transform="rotate(45 50 50)"/><path d="M40 75 V25 M60 75 V25" stroke="black" stroke-width="4"/><path d="M42 30 L58 30 L50 45 Z" fill="black"/></svg>`,
    merge: `<svg viewBox="0 0 100 100"><rect x="10" y="10" width="80" height="80" fill="#ffcc00" stroke="black" transform="rotate(45 50 50)"/><path d="M45 80 V30 M45 30 L35 45 M45 30 L55 45 M65 60 Q65 50 45 40" stroke="black" stroke-width="4" fill="none"/></svg>`,
    noLeft: `<svg viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="white" stroke="#cc0000" stroke-width="6"/><path d="M65 45 L35 45 L45 35 M35 45 L45 55" fill="none" stroke="black" stroke-width="5"/><line x1="20" y1="20" x2="80" y2="80" stroke="#cc0000" stroke-width="6"/></svg>`,
    noUturn: `<svg viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="white" stroke="#cc0000" stroke-width="6"/><path d="M35 60 Q35 35 50 35 Q65 35 65 60" fill="none" stroke="black" stroke-width="5"/><path d="M60 55 L65 65 L70 55" fill="black"/><line x1="20" y1="20" x2="80" y2="80" stroke="#cc0000" stroke-width="6"/></svg>`
};

const EXAMS_DATA = [
    {
        title: "Examen 1: Se√±ales y Reglas",
        questions: [
            { q: "Usted se aproxima a una intersecci√≥n y ve una se√±al roja de 8 lados. ¬øQu√© acci√≥n es obligatoria?", img: 'stop', a: ["Reducir velocidad", "Detenerse por completo", "Ceder el paso"], c: 1, f: "PARE significa detenerse completamente detr√°s de la l√≠nea l√≠mite." },
            { q: "Una se√±al en forma de diamante de color naranja indica:", a: ["Zona escolar", "Zona de construcci√≥n/mantenimiento", "Cruce de ferrocarril"], c: 1, f: "El naranja se usa exclusivamente para advertencias de zonas de trabajo." },
            { q: "¬øQu√© debe hacer ante una se√±al triangular con el v√©rtice hacia abajo (Tri√°ngulo invertido)?", img: 'yield', a: ["Detenerse siempre", "Seguir sin parar", "Ceder el paso al tr√°fico y peatones"], c: 2, f: "La se√±al de Ceda el Paso requiere disminuir la velocidad y parar si es necesario." },
            { q: "Esta se√±al pentagonal (5 lados) de color amarillo/verde advierte sobre:", img: 'school', a: ["Zona escolar o cruce de ni√±os", "Cruce de peatones general", "√Årea de juegos"], c: 0, f: "El pent√°gono indica cercan√≠a a escuelas. Extreme precauci√≥n." },
            { q: "¬øQu√© indica una se√±al redonda de color amarillo con una X negra?", img: 'railroad', a: ["No entrar", "Rotonda adelante", "Advertencia de cruce de ferrocarril"], c: 2, f: "Las se√±ales redondas amarillas advierten sobre v√≠as de tren adelante." },
            { q: "En Delaware, ¬øcon cu√°nta anticipaci√≥n debe se√±alizar un giro?", a: ["100 pies", "200 pies", "300 pies"], c: 2, f: "Debe activar la se√±al al menos 300 pies antes de girar." },
            { q: "¬øQu√© significa una luz roja intermitente en un sem√°foro?", a: ["Precauci√≥n", "Se√±al de PARE (Alto total)", "El sem√°foro no funciona"], c: 1, f: "Debe detenerse por completo y avanzar solo cuando sea seguro." },
            { q: "Usted ve una se√±al circular roja con una barra blanca horizontal. Significa:", img: 'noEntry', a: ["Pare", "No entrar", "Calle sin salida"], c: 1, f: "Indica que est√° prohibido entrar en esa direcci√≥n (Do Not Enter)." },
            { q: "Las se√±ales de color AZUL se utilizan para:", a: ["Reglas de tr√°fico", "Servicios al conductor (gas, comida)", "Zonas de recreaci√≥n"], c: 1, f: "El azul gu√≠a hacia servicios esenciales en la carretera." },
            { q: "Una l√≠nea amarilla s√≥lida de su lado del carril indica:", a: ["Puede rebasar con cuidado", "Prohibido rebasar", "Carril reversible"], c: 1, f: "No debe cruzar una l√≠nea amarilla s√≥lida para adelantar." },
            { q: "¬øCu√°l es el l√≠mite de velocidad en zonas residenciales de Delaware?", a: ["20 MPH", "25 MPH", "35 MPH"], c: 1, f: "25 MPH es el l√≠mite legal en √°reas residenciales y de negocios." },
            { q: "Al estacionar cuesta arriba con bordillo, las ruedas deben girarse:", a: ["Hacia el bordillo", "Hacia afuera (lejos del bordillo)", "Rectas"], c: 1, f: "Hacia afuera, para que el bordillo detenga el auto si rueda atr√°s." },
            { q: "Distancia m√≠nima para estacionar de un hidrante (boca de incendio):", a: ["10 pies", "15 pies", "20 pies"], c: 1, f: "Debe dejar 15 pies libres para acceso de bomberos." },
            { q: "¬øQui√©n tiene la prioridad en una rotonda?", a: ["El que entra", "El que ya circula dentro", "El veh√≠culo m√°s grande"], c: 1, f: "El tr√°fico entrante debe ceder el paso al tr√°fico circulante." },
            { q: "Si un sem√°foro tiene una flecha amarilla fija, significa:", a: ["Giro protegido", "El intervalo de giro termina, prep√°rese a parar", "Siga con precauci√≥n"], c: 1, f: "Indica que la se√±al cambiar√° a rojo inmediatamente." },
            { q: "¬øQu√© debe hacer si su auto empieza a hidroplanear?", a: ["Frenar fuerte", "Quitar el pie del acelerador y mantener el volante recto", "Girar r√°pido"], c: 1, f: "No frene. Deje que el auto pierda velocidad naturalmente." },
            { q: "Es obligatorio encender las luces delanteras cuando:", a: ["Es de noche", "Usa los limpiaparabrisas por lluvia/nieve", "Ambas situaciones"], c: 2, f: "La ley exige luces encendidas siempre que use limpiaparabrisas." },
            { q: "Usted ve esta se√±al (flecha uni√©ndose a l√≠nea recta). Indica:", img: 'merge', a: ["Cruce", "Tr√°fico incorpor√°ndose (Merge)", "Fin de carril"], c: 1, f: "Advierte que el tr√°fico de otra v√≠a se une a la suya." },
            { q: "La regla de seguimiento recomendada en Delaware es de:", a: ["2 segundos", "3 segundos", "4 segundos"], c: 2, f: "4 segundos permiten tiempo suficiente de reacci√≥n." },
            { q: "Un borde de acera (curb) pintado de AMARILLO significa:", a: ["Estacionamiento libre", "Prohibido estacionar", "Solo carga"], c: 1, f: "El amarillo indica zona de prohibido estacionar." },
            { q: "¬øQu√© significa una l√≠nea blanca discontinua?", a: ["Tr√°fico en sentido contrario", "Separa carriles en la misma direcci√≥n", "Borde de v√≠a"], c: 1, f: "Permite cambiar de carril cuando el tr√°fico va en la misma direcci√≥n." },
            { q: "Si se pasa su salida en la autopista, debe:", a: ["Retroceder por el hombrillo", "Girar en U en la mediana", "Seguir a la pr√≥xima salida"], c: 2, f: "Nunca retroceda en una autopista. Es extremadamente peligroso." },
            { q: "¬øQu√© debe hacer ante un sem√°foro apagado (sin luces)?", a: ["Ceder el paso", "Tratarlo como un PARE de 4 v√≠as", "Pasar r√°pido"], c: 1, f: "Todos los veh√≠culos deben detenerse y turnarse." },
            { q: "El uso del cintur√≥n de seguridad es obligatorio para:", a: ["Solo el conductor", "Asientos delanteros", "Todos los ocupantes"], c: 2, f: "La ley cubre a todos los pasajeros del veh√≠culo." },
            { q: "Esta se√±al con una flecha curva y una barra roja significa:", img: 'noLeft', a: ["Curva peligrosa", "Giro a la izquierda prohibido", "No rebasar"], c: 1, f: "El c√≠rculo rojo con barra proh√≠be el movimiento indicado." },
            { q: "Si un peat√≥n lleva un bast√≥n blanco o perro gu√≠a:", a: ["Tiene prioridad absoluta", "Solo en cruces marcados", "Tocar la bocina"], c: 0, f: "Los conductores deben ceder el paso siempre a peatones ciegos." },
            { q: "¬øQu√© indica esta se√±al de advertencia (carretera sinuosa)?", img: 'slippery', a: ["Camino de tierra", "Resbaladizo cuando est√° mojado", "Zona de derrumbes"], c: 1, f: "Reduzca la velocidad cuando llueve si ve esta se√±al." },
            { q: "¬øCu√°l es la penalizaci√≥n por primera ofensa de DUI?", a: ["Multa simple", "Revocaci√≥n de licencia", "Advertencia"], c: 1, f: "Conlleva revocaci√≥n de licencia y programa de rehabilitaci√≥n." },
            { q: "Al rebasar a un ciclista, debe dejar un espacio de:", a: ["1 pie", "2 pies", "3 pies"], c: 2, f: "La ley de 3 pies protege a los usuarios vulnerables." },
            { q: "¬øQu√© indica esta se√±al (flecha en U tachada)?", img: 'noUturn', a: ["No girar en U", "No estacionar", "No girar a la derecha"], c: 0, f: "Proh√≠be dar la vuelta en U en esa intersecci√≥n." }
        ]
    },
    {
        title: "Examen 2: Leyes y Seguridad",
        questions: [
            { q: "La ley 'Move Over' exige que al ver un veh√≠culo de emergencia detenido:", a: ["Acelere", "Cambie de carril o reduzca velocidad", "Se detenga"], c: 1, f: "Debe dar espacio de seguridad a los oficiales." },
            { q: "La ley de 'Consentimiento Implicado' significa que usted acepta:", a: ["Pagar multas", "Hacerse pruebas qu√≠micas de alcohol/drogas", "Ser registrado"], c: 1, f: "Es condici√≥n para tener licencia en Delaware." },
            { q: "Si el acelerador se pega, la primera acci√≥n es:", a: ["Apagar motor", "Cambiar a Neutro (N)", "Frenar a fondo"], c: 1, f: "Neutro desconecta el motor de las ruedas y permite frenar." },
            { q: "Distancia m√≠nima para seguir a un veh√≠culo de emergencia respondiendo:", a: ["300 pies", "500 pies", "1000 pies"], c: 1, f: "Es ilegal seguirlos a menos de 500 pies." },
            { q: "En niebla densa, debe usar:", a: ["Luces altas", "Luces bajas", "Solo cuartos"], c: 1, f: "Las altas reflejan en la niebla y ciegan." },
            { q: "Nivel de alcohol (BAC) para DUI en adultos (21+):", a: ["0.05%", "0.08%", "0.10%"], c: 1, f: "0.08% es el l√≠mite legal de intoxicaci√≥n." },
            { q: "Puntos necesarios para suspensi√≥n de licencia (24 meses):", a: ["10 puntos", "12 puntos", "14 puntos"], c: 2, f: "14 puntos es suspensi√≥n obligatoria seg√∫n el manual." },
            { q: "Conductor menor de 21 con BAC de 0.02%:", a: ["Multa", "Suspensi√≥n por Tolerancia Cero", "Advertencia"], c: 1, f: "Tolerancia cero aplica a menores." },
            { q: "Girar a la izquierda desde calle de un sentido a otra de un sentido:", a: ["Cualquier carril", "Carril izquierdo a carril izquierdo", "Centro"], c: 1, f: "Mantenga su carril lo m√°s a la izquierda posible." },
            { q: "¬øQu√© significa una l√≠nea blanca s√≥lida entre carriles?", a: ["Se puede cambiar carril", "Se desaconseja/proh√≠be cambiar carril", "Tr√°fico opuesto"], c: 1, f: "Indica que debe permanecer en su carril." },
            { q: "Distancia para cambiar de luces altas a bajas con auto de frente:", a: ["200 pies", "500 pies", "300 pies"], c: 1, f: "500 pies para evitar cegar al otro conductor." },
            { q: "¬øD√≥nde est√° la 'No-Zone' de un cami√≥n?", a: ["Frente", "Puntos ciegos (lados/atr√°s)", "Techo"], c: 1, f: "Si no ve los espejos del cami√≥n, el conductor no lo ve a usted." },
            { q: "Si un cami√≥n va a girar a la derecha:", a: ["Rebasar por derecha", "Esperar detr√°s", "Tocar bocina"], c: 1, f: "Los camiones se abren a la izquierda para girar a la derecha." },
            { q: "Multa por no tener seguro (1ra ofensa):", a: ["$100 - $200", "$1,500 - $2,000", "$500"], c: 1, f: "Las multas por falta de seguro son altas." },
            { q: "Si choca un auto estacionado y no halla al due√±o:", a: ["Irse", "Dejar nota con sus datos", "Esperar 10 min"], c: 1, f: "Debe dejar su informaci√≥n visible." },
            { q: "Los ni√±os deben ir en asiento de seguridad hasta:", a: ["5 a√±os", "8 a√±os o 66 libras", "10 a√±os"], c: 1, f: "Ley de seguridad infantil de Delaware." },
            { q: "Si se revienta una llanta:", a: ["Frenar seco", "Sujetar volante firme, no frenar", "Girar"], c: 1, f: "Mantenga el control y deje que el auto pare solo." },
            { q: "Uso de celular para conductores con permiso GDL:", a: ["Manos libres", "Prohibido totalmente", "Solo emergencias"], c: 1, f: "Conductores novatos no pueden usar ning√∫n dispositivo." },
            { q: "¬øQu√© indica esta se√±al (camino dividido comienza)?", img: 'divided', a: ["Fin camino dividido", "Comienzo camino dividido", "Puente"], c: 1, f: "Advierte de una mediana f√≠sica adelante." },
            { q: "Al entrar a una autopista, use el carril de aceleraci√≥n para:", a: ["Parar y mirar", "Igualar velocidad del tr√°fico", "Ir lento"], c: 1, f: "Debe entrar a la misma velocidad que el flujo." },
            { q: "La se√±al de 'Veh√≠culo Lento' es un tri√°ngulo:", a: ["Azul", "Naranja fluorescente", "Blanco"], c: 1, f: "Tri√°ngulo naranja con borde rojo indica < 25 MPH." },
            { q: "Distancia para estacionar de un cruce de tren:", a: ["20 pies", "50 pies", "100 pies"], c: 1, f: "50 pies es el m√≠nimo legal." },
            { q: "Si ve un animal en la carretera:", a: ["Girar bruscamente", "Frenar controlado, no girar bruscamente", "Acelerar"], c: 1, f: "Girar bruscamente causa choques m√°s graves." },
            { q: "Las motocicletas tienen derecho a:", a: ["Medio carril", "Ancho completo del carril", "Circular por la l√≠nea"], c: 1, f: "Tienen los mismos derechos de espacio que un auto." },
            { q: "Si un oficial le detiene:", a: ["Salga del auto", "Manos en el volante", "Busque documentos r√°pido"], c: 1, f: "Mantenga las manos visibles por seguridad." },
            { q: "Hielo negro es:", a: ["Hielo sucio", "Hielo transparente dif√≠cil de ver", "Nieve"], c: 1, f: "Es muy peligroso porque parece asfalto mojado." },
            { q: "Distancia visual (cu√°ntos segundos mirar adelante):", a: ["5 seg", "10 seg", "2 seg"], c: 1, f: "Mire 10-12 segundos adelante para anticipar peligros." },
            { q: "Si su veh√≠culo empieza a patinar:", a: ["Frene", "Gire hacia donde quiere ir", "Acelere"], c: 1, f: "Corrija la direcci√≥n suavemente." },
            { q: "Los peatones deben caminar:", a: ["De espaldas al tr√°fico", "De frente al tr√°fico", "Por el centro"], c: 1, f: "Si no hay acera, camine de frente al tr√°fico." },
            { q: "¬øCu√°ndo es m√°s resbaladiza la carretera en lluvia?", a: ["Despu√©s de 1 hora", "Los primeros minutos", "Al secarse"], c: 1, f: "El aceite y polvo flotan al inicio de la lluvia." }
        ]
    },
    {
        title: "Examen 3: Se√±ales Avanzadas y Situaciones",
        questions: [
            { q: "Usted ve una se√±al rectangular blanca que dice 'Left Turn Only'. Esto es una se√±al de:", a: ["Advertencia", "Regulaci√≥n (Control)", "Gu√≠a"], c: 1, f: "Las se√±ales blancas rectangulares son regulatorias." },
            { q: "¬øDe qu√© color son las se√±ales de zonas de recreaci√≥n p√∫blica?", a: ["Verde", "Marr√≥n", "Azul"], c: 1, f: "El marr√≥n se usa para parques y recreaci√≥n." },
            { q: "Si un oficial de polic√≠a est√° dirigiendo el tr√°fico en un sem√°foro en rojo:", a: ["Det√©ngase hasta que cambie a verde", "Obedezca al oficial y pase", "Toque la bocina"], c: 1, f: "Las √≥rdenes del oficial anulan las se√±ales de tr√°fico." },
            { q: "Conducir a la defensiva significa:", a: ["Esperar que otros cometan errores", "Conducir despacio", "Tocar la bocina"], c: 0, f: "Debe anticipar errores de otros conductores." },
            { q: "En una autopista de 3 carriles, el carril izquierdo es para:", a: ["Tr√°fico lento", "Rebasar solamente", "Camiones"], c: 1, f: "El carril izquierdo es para rebasar o tr√°fico r√°pido." },
            { q: "Si se le caen los limpiaparabrisas en plena lluvia:", a: ["Saque la cabeza por la ventana", "Pare de inmediato fuera de la v√≠a", "Siga despacio"], c: 1, f: "No puede conducir si no tiene visibilidad clara." },
            { q: "La se√±al de 'Cruce de Venados' es de color:", a: ["Amarillo", "Naranja", "Blanco"], c: 0, f: "Es una se√±al de advertencia est√°ndar (amarilla)." },
            { q: "Al dar marcha atr√°s (retroceder), usted debe:", a: ["Usar solo los espejos", "Girar la cabeza y mirar atr√°s", "Tocar la bocina"], c: 1, f: "Los espejos tienen puntos ciegos; mire directamente." },
            { q: "Si su auto se incendia:", a: ["Acelere para apagarlo", "Use agua", "Salga y al√©jese 100 pies"], c: 2, f: "El tanque de gasolina podr√≠a explotar." },
            { q: "Es ilegal estacionar en un cruce de peatones:", a: ["Siempre", "Solo si est√° marcado", "Solo de d√≠a"], c: 0, f: "Nunca bloquee el paso de peatones." },
            { q: "¬øCu√°ndo puede usar neum√°ticos con clavos en Delaware?", a: ["Todo el a√±o", "15 Oct - 15 Abr", "Solo en nieve"], c: 1, f: "Est√°n permitidos solo en invierno para evitar da√±os a la v√≠a." },
            { q: "Si dos autos llegan a una intersecci√≥n de 4 altos al mismo tiempo:", a: ["El de la izquierda pasa", "El de la derecha pasa", "El m√°s r√°pido"], c: 1, f: "El conductor de la izquierda cede al de la derecha." },
            { q: "La l√≠nea de parada (stop line) es:", a: ["Una l√≠nea amarilla", "Una l√≠nea blanca ancha", "Una l√≠nea azul"], c: 1, f: "Indica d√≥nde debe detenerse el parachoques delantero." },
            { q: "Si conduce con sue√±o:", a: ["Abra la ventana", "Ponga m√∫sica fuerte", "Pare y descanse"], c: 2, f: "Solo dormir soluciona la fatiga." },
            { q: "El alcohol afecta primero:", a: ["La visi√≥n", "El juicio y el criterio", "La coordinaci√≥n"], c: 1, f: "El juicio se ve afectado antes que las habilidades motoras." },
            { q: "Si un conductor se le pega mucho atr√°s (tailgating):", a: ["Frene de golpe", "Acelere", "C√°mbiese de carril o reduzca velocidad gradualmente"], c: 2, f: "Permita que lo rebase para evitar accidentes." },
            { q: "En Delaware, ¬øqui√©n es responsable de que un menor use cintur√≥n?", a: ["El menor", "El conductor", "Nadie"], c: 1, f: "El conductor recibe la multa." },
            { q: "Usted debe se√±alizar para salir de una rotonda:", a: ["No es necesario", "S√≠, justo antes de salir", "Solo si hay autos"], c: 1, f: "Indique su intenci√≥n de salir para no confundir a otros." },
            { q: "Si ve una luz amarilla intermitente en una zona escolar:", a: ["Acelere", "Reduzca a 20 MPH", "Pare"], c: 1, f: "Indica que el l√≠mite escolar est√° activo." },
            { q: "¬øQu√© veh√≠culo debe detenerse siempre en cruces de tren?", a: ["Autos deportivos", "Buses escolares y camiones con materiales peligrosos", "Motos"], c: 1, f: "Est√°n obligados por ley a parar y mirar." },
            { q: "Si hay neblina, reduzca la velocidad y:", a: ["Aumente la distancia de seguimiento", "Apague las luces", "Use luces altas"], c: 0, f: "Necesita m√°s espacio para detenerse." },
            { q: "La se√±al de 'Fin de Carril' (Lane Ends) significa:", a: ["Acelerar", "Fusionarse (Merge) con seguridad", "Parar"], c: 1, f: "Prep√°rese para cambiar de carril." },
            { q: "Si toma medicamentos recetados:", a: ["No conduzca si causan sue√±o", "Conduzca r√°pido", "Tome caf√©"], c: 0, f: "Revise las advertencias de la etiqueta." },
            { q: "En un cruce sin sem√°foros, ceda el paso a:", a: ["Nadie", "Veh√≠culos que ya est√°n en el cruce", "Los de atr√°s"], c: 1, f: "Quien llega primero o est√° dentro tiene prioridad." },
            { q: "Las luces de freno deben ser visibles a:", a: ["100 pies", "300 pies", "500 pies"], c: 1, f: "Requisito legal de equipo." },
            { q: "Si su auto cae al agua:", a: ["Espere ayuda", "Salga inmediatamente por la ventana", "Llame al 911 dentro"], c: 1, f: "Escape antes de que el auto se hunda." },
            { q: "No debe conducir en el carril central compartido por m√°s de:", a: ["50 pies", "200 pies", "500 pies"], c: 2, f: "Es solo para preparar giros, no para viajar." },
            { q: "Si un peat√≥n cruza fuera del paso de cebra:", a: ["Tiene la culpa, atrop√©llelo", "Ceda el paso de todos modos", "Toque bocina y siga"], c: 1, f: "La ley exige evitar atropellos siempre." },
            { q: "El registro de su veh√≠culo vence:", a: ["El d√≠a de su cumplea√±os", "El d√≠a que lo compr√≥", "Cuando indica la calcoman√≠a"], c: 2, f: "Verifique la fecha en la placa." },
            { q: "Para evitar puntos ciegos al conducir:", a: ["Mire solo al frente", "Gire la cabeza antes de cambiar carril", "Conf√≠e en los espejos"], c: 1, f: "Los espejos no muestran todo el panorama." }
        ]
    },
    {
        title: "Examen 4: Repaso General",
        questions: [
            { q: "Si usted se niega a una prueba qu√≠mica (alcoholemia):", a: ["Recibe una multa", "Su licencia ser√° revocada (Consentimiento Implicado)", "No pasa nada"], c: 1, f: "La revocaci√≥n es autom√°tica por negarse." },
            { q: "Al salir de un estacionamiento privado a la calle:", a: ["Tiene prioridad", "Debe parar y ceder el paso", "Toque bocina"], c: 1, f: "El tr√°fico en la v√≠a p√∫blica tiene prioridad." },
            { q: "La mejor manera de prevenir el hidroplaneo es:", a: ["Llantas nuevas", "Bajar la velocidad", "Frenar en charcos"], c: 1, f: "La velocidad es el factor principal." },
            { q: "Si un conductor viene de frente en su carril:", a: ["Frene y gire a la derecha", "Gire a la izquierda", "Toque bocina y siga"], c: 0, f: "Nunca gire a la izquierda (hacia el otro tr√°fico)." },
            { q: "Distancia para se√±alizar en autopista:", a: ["100 pies", "300 pies", "500 pies"], c: 2, f: "A mayor velocidad, mayor distancia de aviso." },
            { q: "Usted puede girar en U:", a: ["En curvas", "Donde sea seguro y legal", "En cimas de colinas"], c: 1, f: "Prohibido donde la visi√≥n sea limitada." },
            { q: "L√≠mite de velocidad en autopistas divididas (Route 1/I-95):", a: ["55 MPH", "65 MPH", "75 MPH"], c: 1, f: "Generalmente es 65 MPH a menos que se indique otro." },
            { q: "Si hay un oficial de polic√≠a al borde de la v√≠a:", a: ["Siga igual", "Ley Move Over: al√©jese o baje velocidad", "Pare a mirar"], c: 1, f: "Aplica tambi√©n para veh√≠culos de polic√≠a." },
            { q: "Los ciclistas deben obedecer:", a: ["Solo se√±ales de pare", "Las mismas leyes que los autos", "Reglas de peatones"], c: 1, f: "Son considerados veh√≠culos en la v√≠a." },
            { q: "Si su licencia est√° suspendida:", a: ["Conduzca solo al trabajo", "No puede conducir bajo ninguna circunstancia", "Conduzca con cuidado"], c: 1, f: "Conducir suspendido es un delito grave." },
            { q: "El freno de mano se usa:", a: ["Solo en colinas", "Cada vez que estaciona", "Nunca"], c: 1, f: "Asegura el veh√≠culo y mantiene el sistema funcional." },
            { q: "Si empieza a sentir sue√±o al conducir:", a: ["Abra la ventana", "Pare en un lugar seguro y duerma", "Suba el volumen"], c: 1, f: "Los trucos no funcionan contra el sue√±o real." },
            { q: "En un cruce de peatones sin sem√°foro:", a: ["Los peatones ceden", "Los autos ceden a los peatones", "El m√°s r√°pido pasa"], c: 1, f: "El peat√≥n tiene prioridad en el cruce." },
            { q: "La distancia de reacci√≥n es:", a: ["Distancia antes de ver el peligro", "Distancia recorrida mientras mueve el pie al freno", "Distancia total"], c: 1, f: "Es el tiempo que tarda el cerebro en actuar." },
            { q: "Si su auto se da√±a en la autopista:", a: ["Pare en el carril", "Mueva el auto al hombrillo", "Abandone el auto"], c: 1, f: "Despeje la v√≠a lo m√°s pronto posible." },
            { q: "Los ni√±os no deben sentarse en el asiento delantero si:", a: ["Tienen menos de 12 a√±os/65 pulgadas", "Tienen menos de 5 a√±os", "Tienen sue√±o"], c: 0, f: "Las bolsas de aire pueden herirlos gravemente." },
            { q: "Un sem√°foro con flecha roja significa:", a: ["Pare y gire", "No gire en esa direcci√≥n", "Ceda el paso"], c: 1, f: "Proh√≠be el movimiento en la direcci√≥n de la flecha." },
            { q: "Si ve una se√±al de 'BUMP' (Bache/Resalto):", a: ["Acelere", "Reduzca velocidad", "Ignore"], c: 1, f: "Advierte de una irregularidad en la superficie." },
            { q: "El espacio de 'colch√≥n' ideal es:", a: ["Al frente", "Atr√°s", "Alrededor de todo el veh√≠culo"], c: 2, f: "Mantenga espacio en los 4 lados si es posible." },
            { q: "Si un animal peque√±o sale a la v√≠a:", a: ["Frene de golpe", "Gire bruscamente", "No arriesgue su vida por el animal"], c: 2, f: "Girar puede causar un choque frontal mortal." },
            { q: "Las multas en zonas de construcci√≥n son:", a: ["Iguales", "Dobles", "Triples"], c: 1, f: "Se duplican para proteger a los trabajadores." },
            { q: "Debe notificar al DMV si cambia de direcci√≥n en:", a: ["10 d√≠as", "30 d√≠as", "60 d√≠as"], c: 1, f: "Tiene 30 d√≠as para actualizar su registro." },
            { q: "Conducir agresivamente incluye:", a: ["Seguir muy de cerca y cambios bruscos", "Conducir l√≠mite", "Usar direccionales"], c: 0, f: "Es un comportamiento peligroso sancionable." },
            { q: "Si un bus escolar para en una v√≠a dividida (4 carriles con mediana):", a: ["Todos paran", "Solo su lado para", "Nadie para"], c: 1, f: "Si hay mediana f√≠sica, el lado opuesto no para." },
            { q: "El 'Punto de No Retorno' es:", a: ["Cuando ya no puede parar seguro en amarillo", "Mitad de camino", "Un lugar tur√≠stico"], c: 0, f: "Debe cruzar si frenar es m√°s peligroso." },
            { q: "Para evitar fatiga visual nocturna:", a: ["Mire las luces de otros", "Mire hacia el borde derecho", "Cierre un ojo"], c: 1, f: "Evite mirar directo a los faros contrarios." },
            { q: "Si hay hielo en la carretera:", a: ["Maneje normal", "Reduzca velocidad y aumente distancia", "Use 4x4 y corra"], c: 1, f: "La distancia de frenado aumenta 10 veces." },
            { q: "Un sem√°foro amarillo intermitente significa:", a: ["Parar", "Proceder con precauci√≥n", "Giro protegido"], c: 1, f: "No requiere parar, solo estar alerta." },
            { q: "La se√±al de 'YIELD' es un:", a: ["Oct√°gono", "Tri√°ngulo", "C√≠rculo"], c: 1, f: "Tri√°ngulo rojo invertido." },
            { q: "¬øQui√©n es responsable de las condiciones del auto?", a: ["El mec√°nico", "El conductor", "El pasajero"], c: 1, f: "Usted debe revisar luces, llantas y frenos." }
        ]
    }
];

// --- L√ìGICA DE CONTROL ---
let activeExamIdx = 0;
let currentQIdx = 0;
let score = 0;
let shuffledOptions = [];

function initFirstAvailable() {
    const progress = JSON.parse(localStorage.getItem('dmv_prog') || "[true, false, false, false]");
    const passed = JSON.parse(localStorage.getItem('dmv_passed') || "[false, false, false, false]");
    
    let target = 0;
    // Buscar el primer examen disponible que no se haya pasado
    for(let i=0; i<4; i++) {
        if(progress[i] && !passed[i]) {
            target = i;
            break;
        }
        // Si todos los disponibles est√°n pasados, ir al √∫ltimo desbloqueado
        if(progress[i]) target = i;
    }
    startExam(target);
}

function showHome() {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById('screen-home').classList.add('active');
    
    const progress = JSON.parse(localStorage.getItem('dmv_prog') || "[true, false, false, false]");
    const passed = JSON.parse(localStorage.getItem('dmv_passed') || "[false, false, false, false]");
    
    const container = document.getElementById('exam-selector-area');
    container.innerHTML = "";

    EXAMS_DATA.forEach((exam, i) => {
        const isUnlocked = progress[i];
        const isPassed = passed[i];
        const card = document.createElement('div');
        
        card.className = `exam-card ${isPassed ? 'passed' : (isUnlocked ? 'unlocked' : 'locked')}`;
        
        let icon = isUnlocked ? 'üîì' : 'üîí';
        if(isPassed) icon = '‚úÖ';

        card.innerHTML = `
            <span class="icon-state">${icon}</span>
            <span class="exam-title">${exam.title}</span>
            <span class="exam-status">${isPassed ? 'APROBADO' : (isUnlocked ? 'DISPONIBLE' : 'BLOQUEADO')}</span>
            <button class="btn-enter" onclick="event.stopPropagation(); startExam(${i})">ENTRAR</button>
        `;
        
        if(isUnlocked) card.onclick = () => startExam(i);
        container.appendChild(card);
    });
}

function startExam(idx) {
    activeExamIdx = idx;
    currentQIdx = 0;
    score = 0;
    document.getElementById('screen-home').classList.remove('active');
    document.getElementById('screen-result').classList.remove('active');
    document.getElementById('screen-quiz').classList.add('active');
    loadQuestion();
}

function loadQuestion() {
    const qData = EXAMS_DATA[activeExamIdx].questions[currentQIdx];
    
    document.getElementById('progress-fill').style.width = `${(currentQIdx / 30) * 100}%`;
    document.getElementById('q-exam-name').innerText = EXAMS_DATA[activeExamIdx].title;
    document.getElementById('q-counter').innerText = `PREGUNTA ${currentQIdx + 1} / 30`;
    
    document.getElementById('q-text').innerText = qData.q;
    document.getElementById('q-image').innerHTML = qData.img ? SVGS[qData.img] : "";
    
    // Barajar opciones
    const options = qData.a.map((t, i) => ({ t, ok: i === qData.c }));
    shuffledOptions = options.sort(() => Math.random() - 0.5);

    const container = document.getElementById('options-area');
    container.innerHTML = "";
    
    const letters = ["A", "B", "C", "D"];
    shuffledOptions.forEach((opt, i) => {
        const div = document.createElement('div');
        div.className = 'option-item';
        div.innerHTML = `<span class="letter">${letters[i]}</span> <span>${opt.t}</span>`;
        div.onclick = () => check(i, div);
        container.appendChild(div);
    });

    document.getElementById('feedback').style.display = 'none';
    document.getElementById('btn-next').style.display = 'none';
}

function check(idx, el) {
    const isOk = shuffledOptions[idx].ok;
    const fb = document.getElementById('feedback');
    fb.style.display = 'block';
    fb.innerHTML = `<strong>${isOk ? "¬°CORRECTO!" : "INCORRECTO"}</strong><br>${EXAMS_DATA[activeExamIdx].questions[currentQIdx].f}`;
    fb.className = isOk ? 'fb-success' : 'fb-danger';

    if(isOk) { score++; el.classList.add('correct'); }
    else {
        el.classList.add('incorrect');
        const cIdx = shuffledOptions.findIndex(o => o.ok);
        document.getElementById('options-area').children[cIdx].classList.add('correct');
    }

    Array.from(document.getElementById('options-area').children).forEach(o => o.style.pointerEvents = 'none');
    document.getElementById('btn-next').style.display = 'block';
}

function handleNext() {
    currentQIdx++;
    if(currentQIdx < 30) loadQuestion();
    else showResult();
}

function showResult() {
    document.getElementById('screen-quiz').classList.remove('active');
    const resScreen = document.getElementById('screen-result');
    resScreen.classList.add('active');

    const percent = Math.round((score / 30) * 100);
    const passed = percent >= 80;

    document.getElementById('res-percent').innerText = `${percent}%`;
    document.getElementById('res-percent').style.color = passed ? "var(--success)" : "var(--danger)";
    document.getElementById('res-stats').innerText = `${score} de 30 respuestas correctas`;
    document.getElementById('res-title').innerText = passed ? "¬°APROBADO!" : "NO APROBADO";

    const actionArea = document.getElementById('res-action-area');
    actionArea.innerHTML = "";

    if(passed) {
        let prog = JSON.parse(localStorage.getItem('dmv_prog') || "[true, false, false, false]");
        let passArr = JSON.parse(localStorage.getItem('dmv_passed') || "[false, false, false, false]");
        
        passArr[activeExamIdx] = true;
        if(activeExamIdx < 3) prog[activeExamIdx + 1] = true;
        
        localStorage.setItem('dmv_prog', JSON.stringify(prog));
        localStorage.setItem('dmv_passed', JSON.stringify(passArr));

        if(activeExamIdx < 3) {
            const b = document.createElement('button');
            b.className = "btn btn-primary";
            b.innerText = "Siguiente Examen ‚Üí";
            b.onclick = () => startExam(activeExamIdx + 1);
            actionArea.appendChild(b);
        } else {
            actionArea.innerHTML = "<p style='color:green; font-weight:bold; font-size:1.2em'>üéâ ¬°Has completado todo el curso! üéâ</p>";
        }
    } else {
        const b = document.createElement('button');
        b.className = "btn btn-primary";
        b.innerText = "Reintentar Examen";
        b.onclick = () => startExam(activeExamIdx);
        actionArea.appendChild(b);
    }
}

function resetStorage() {
    if(confirm("¬øSeguro que quieres borrar todo tu progreso?")) {
        localStorage.clear();
        location.reload();
    }
}

// Iniciar
showHome();
</script>
</body>
</html>
